import i from"fs";import c from"path";import{createRequire as a}from"module";async function h(r){try{const e=r||process.env.CONFIG_PATH;if(!e)throw new Error("\u8BF7\u6307\u5B9A\u914D\u7F6E\u6587\u4EF6\u8DEF\u5F84\u3002\u4F7F\u7528\u53C2\u6570\u4F20\u5165\u6216\u8BBE\u7F6E CONFIG_PATH \u73AF\u5883\u53D8\u91CF");const o=c.resolve(process.cwd(),e);if(!i.existsSync(o))throw new Error(`\u914D\u7F6E\u6587\u4EF6\u4E0D\u5B58\u5728: ${o}`);const t=a(import.meta.url);delete t.cache[o];let n;try{n=t(o)}catch(s){throw new Error(`\u914D\u7F6E\u6587\u4EF6\u683C\u5F0F\u9519\u8BEF: ${s.message}\u3002\u8BF7\u786E\u4FDD\u914D\u7F6E\u6587\u4EF6\u4F7F\u7528 CommonJS \u683C\u5F0F (module.exports = config)`)}if(!n||typeof n!="object")throw new Error("\u914D\u7F6E\u6587\u4EF6\u683C\u5F0F\u65E0\u6548");return console.error("\u2705 \u914D\u7F6E\u52A0\u8F7D\u6210\u529F\uFF0C\u5305\u542B\u67E5\u8BE2:",Object.keys(n.queries||{}).length,"\u4E2A"),n}catch(e){if(e.message.includes("\u8BF7\u6307\u5B9A\u914D\u7F6E\u6587\u4EF6\u8DEF\u5F84")||e.message.includes("\u914D\u7F6E\u6587\u4EF6\u4E0D\u5B58\u5728"))throw e;return console.warn("\u26A0\uFE0F \u914D\u7F6E\u6587\u4EF6\u89E3\u6790\u5931\u8D25\uFF0C\u4F7F\u7528\u9ED8\u8BA4\u914D\u7F6E:",e.message),{baseUrl:"https://your-grafana-instance.com",defaultHeaders:{"Content-Type":"application/json"},queries:{}}}}async function p(r,e){try{const o=e||process.env.CONFIG_PATH;if(!o)throw new Error("\u8BF7\u6307\u5B9A\u914D\u7F6E\u6587\u4EF6\u8DEF\u5F84\u3002\u4F7F\u7528\u53C2\u6570\u4F20\u5165\u6216\u8BBE\u7F6E CONFIG_PATH \u73AF\u5883\u53D8\u91CF");const t=c.resolve(process.cwd(),o),n=`const config = ${JSON.stringify(r,null,2)};

module.exports = config;`,s=c.dirname(t);return i.existsSync(s)||i.mkdirSync(s,{recursive:!0}),await i.promises.writeFile(t,n,"utf-8"),console.error(`\u2705 \u914D\u7F6E\u5DF2\u4FDD\u5B58\u81F3: ${t}`),!0}catch(o){return console.error("\u274C \u4FDD\u5B58\u914D\u7F6E\u5931\u8D25:",o),!1}}function m(){const r=process.env.CONFIG_PATH;if(!r)throw new Error("\u8BF7\u8BBE\u7F6E CONFIG_PATH \u73AF\u5883\u53D8\u91CF\u6307\u5B9A\u914D\u7F6E\u6587\u4EF6\u8DEF\u5F84");return r}function d(r){const e=[];return r?(r.baseUrl||e.push("\u7F3A\u5C11baseUrl\u914D\u7F6E"),r.queries&&Object.entries(r.queries).forEach(([o,t])=>{t.url||e.push(`\u67E5\u8BE2 "${o}" \u7F3A\u5C11url\u914D\u7F6E`)}),{valid:e.length===0,errors:e}):(e.push("\u914D\u7F6E\u4E0D\u80FD\u4E3A\u7A7A"),{valid:!1,errors:e})}export{m as getConfigPath,h as loadConfig,p as saveConfig,d as validateConfig};
